%-----------------------------------------------------------------------------------------------------------------------------------------------%
%	The MIT License (MIT)
%
%	Copyright (c) 2021 Jitin Nair
%
%	Permission is hereby granted, free of charge, to any person obtaining a copy
%	of this software and associated documentation files (the "Software"), to deal
%	in the Software without restriction, including without limitation the rights
%	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
%	copies of the Software, and to permit persons to whom the Software is
%	furnished to do so, subject to the following conditions:
%
%	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
%	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
%	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
%	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
%	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
%	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
%	THE SOFTWARE.
%-----------------------------------------------------------------------------------------------------------------------------------------------%

\documentclass[a4paper,12pt]{article}

%----------------------------------------------------------------------------------------
%  PACKAGES / ENCODING
%----------------------------------------------------------------------------------------
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}

\usepackage{indentfirst}
\usepackage[left=3cm,right=1.5cm,top=2cm,bottom=2cm]{geometry}
\setlength{\parindent}{1.25cm}
\usepackage{url}
\usepackage{csquotes}
\usepackage{amsmath,amssymb,mathtools}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{enumitem}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{subcaption}
\usepackage{placeins}
\usepackage{titlesec}
\usepackage[unicode]{hyperref}

% Section style
\titleformat{\section}{\large\bfseries\centering}{\thesection.}{0.5em}{}
\titlespacing{\section}{0pt}{12pt}{6pt}
\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection.}{0.5em}{}
\titleformat{\subsubsection}{\normalsize\itshape}{\thesubsubsection.}{0.5em}{}

% Bibliography (numeric like in the Markdown draft)
\usepackage[backend=biber,style=gost-numeric,sorting=none,maxbibnames=3]{biblatex}
\addbibresource{citations.bib}
\setlength\bibitemsep{0.6em}

% Listings
\lstset{
  basicstyle=\ttfamily\small,
  breaklines=true,
  frame=single,
  columns=fullflexible
}

% Helper: figures that don't break compilation if image missing
\newcommand{\maybeincludegraphics}[2][]{%
  \IfFileExists{#2}{\includegraphics[#1]{#2}}{%
    \fbox{\parbox{\linewidth}{\textbf{Файл рисунка не найден:} \texttt{\detokenize{#2}}}}%
  }%
}

%----------------------------------------------------------------------------------------
%  TITLE
%----------------------------------------------------------------------------------------
\begin{document}
\begin{samepage}
\noindent\textbf{УДК 519.872}
\vspace{1em}

\begin{center}
{\Large\bfseries Расчёт многоканальных СМО с отрицательными заявками}
\end{center}
\vspace{0.8em}

\begin{center}
Р.\,С.~Хабаров\textsuperscript{1}, к.\,т.\,н.\\[2pt]
E-mail: xabarov.r@yandex.ru\\[6pt]
В.\,А.~Лохвицкий\textsuperscript{1}, д.\,т.\,н.\\[2pt]
E-mail: lokhv\_va@mail.ru\\[8pt]
{\small\textsuperscript{1}Военно-космическая академия им.\,А.\,Ф.\,Можайского, Санкт-Петербург, Россия}
\end{center}
\vspace{0.5em}

\begin{abstract}
Предложен численный метод расчёта многоканальных систем массового обслуживания с произвольным распределением времени обслуживания (аппроксимируемым гиперэкспоненциальным \(H_2\) с комплексными параметрами) 
и двумя дисциплинами обработки отрицательных заявок: \textbf{RCS} (удаление заявки на обслуживании) и \textbf{катастрофы} (мгновенная очистка системы). 
Метод расширяет алгоритм Такахаси--Таками модификацией матриц переходов микросостояний и позволяет получать не только стационарные вероятности состояний, но и временные характеристики --- начальные моменты времени ожидания и пребывания. 
Получены результаты для вариантов поведения положительных заявок при поступлении отрицательной заявки: при уходе из системы, при направлении на повторное обслуживание с перегенерацией длительности и при повторном обслуживании \emph{без} пересемплирования (с фиксированной длительностью на заявку). 
\end{abstract}

\textbf{Ключевые слова:} теория массового обслуживания, отрицательные заявки, катастрофы, RCS, метод Такахаси--Таками, фазовые аппроксимации, \(H_2\), преобразование Лапласа--Стилтьеса.

\begin{otherlanguage}{english}
\bigskip
\begin{center}
\textbf{Calculation of Multi-channel Queueing Systems with Negative Customers}
\end{center}
\smallskip

\textbf{Abstract.} A numerical method is proposed for calculating multi-channel queueing systems with an arbitrary service time distribution (approximated by hyperexponential \(H_2\) with complex parameters) and two negative customer handling disciplines: \textbf{RCS} (Remove Customer in Service) and \textbf{disasters} (instantaneous system clearing). The method extends the Takahashi--Takami algorithm by modifying microstate transition matrices and yields both stationary state probabilities and time-based performance measures~--- initial moments of waiting and sojourn times. Results are obtained for positive customers' behavior upon a negative arrival: removal from the system, restart with resampling, and restart without resampling (fixed service requirement per job).

\textbf{Keywords:} queueing theory, negative customers, disasters, RCS, Takahashi--Takami method, phase approximations, \(H_2\), Laplace--Stieltjes transform.
\end{otherlanguage}
\end{samepage}

%----------------------------------------------------------------------------------------
%  INTRO
%----------------------------------------------------------------------------------------
\section{Введение}
Метод Такахаси--Таками \cite{takahashi1976} изначально предложен для общего класса систем \(GI/G/c\); в монографии Рыжикова \cite{ryzhikov2018ru} подробно изложены многоканальные фазовые системы и итерационное 
решение векторно-матричных уравнений баланса с блоками \(A_j,B_j,C_j,D_j\). Метод применим к достаточно широкому классу систем (в том числе \(M/H_k/n\), \(H_k/M/n\) и др.); 
в данной работе рассматриваются системы с \emph{пуассоновским входом} интенсивности \(\lambda\) и \emph{распределением времени обслуживания} \(B\), аппроксимируемым гиперэкспоненциальным \(H_2\) с комплексными параметрами, 
что позволяет описывать системы с произвольным коэффициентом вариации при \(n\) каналах. Предположения о пуассоновском потоке заявок и произвольном обслуживании являются достаточно общими для многих реальных систем \cite{kleinrock1979ru,bocharov2004ru}.

В последние десятилетия значительный интерес вызывает исследование систем с отрицательными заявками (negative customers), введёнными в работах Геленбе \cite{gelenbe1991,gelenbe1992}. 
Отрицательные заявки при поступлении могут удалять положительные заявки в соответствии с различными дисциплинами. В работе рассматриваются две дисциплины обслуживания: \textbf{RCS (Remove Customer in Service)} --- воздействие на одну заявку в обслуживании (удаление); \textbf{катастрофы} --- мгновенная очистка системы от всех положительных заявок. 
Далее через \(\delta\) обозначается интенсивность потока отрицательных заявок, \(W\) и \(V\) --- времена ожидания в очереди и пребывания в системе (случайные величины), \(w_1\) и \(v_1\) --- их первые начальные моменты (математические ожидания).

Исследования СМО с отрицательными заявками обычно связывают с работами Э.~Геленбе (G-сети с «сигналами»); ключевой результат --- существование стационарных распределений в мультипликативной форме (product-form) при марковских предпосылках и ограничениях на механизмы удаления \cite{gelenbe1991,gelenbe1992}. G-сети обобщались на случаи зависящих от состояния интенсивностей, пакетных перемещений и многоклассовых заявок, сохраняя мультипликативную форму стационарных распределений при экспоненциальных предпосылках. 
Обзор подходов к сигналам и стратегиям удаления приведён в \cite{artalejo2000}. Для одноканальных систем \(M/G/1\) сформировалась аналитическая ветка (дополнительная переменная, интегральные уравнения), 
позволяющая описывать стационарные распределения и временные характеристики \cite{harrison1996}; развивались также факторизация Винера--Хопфа \cite{bayer1996} и интерпретации удаления работы \cite{boucherie1996}. 
Отдельная линия --- \emph{катастрофы}: для \(M/G/1\) получены аналоги формулы Поллачека--Хинчина для стационарного распределения числа заявок в системе и времени пребывания, подчёркивающие роль преобразования Лапласа--Стилтьеса (ПЛС), \(T^*(s)=\mathbb{E}[e^{-sT}]\), \(s\ge 0\), и корректной трактовки «обрезания» траектории катастрофой \cite{jain1996}. 
Модели с катастрофами обобщались на BMAP/SM/1 \cite{dudin1999}, дисциплину с разделением процессора \cite{li2006}, дискретное время \cite{atencia2004}, повторные попытки и отказы прибора \cite{artalejo1998,wang2008}. Для многоканальных моделей встречаются марковские частные случаи \cite{dharmaraja2015}; интерес к системам с отрицательными заявками и катастрофами сохраняется в последние годы (дискретное время, параллельные очереди, гетерогенные приборы), однако расчёт при произвольном обслуживании в многоканальном случае остаётся нетривиальным.

В данной работе предложено расширение метода Такахаси--Таками для многоканальных СМО с отрицательными заявками: вводятся правила формирования матриц переходов для дисциплин RCS и катастроф, а также алгоритмы вычисления первых начальных моментов времени ожидания и пребывания \(w_1\) и \(v_1\), согласованные с имитационным моделированием. В результате метод позволяет получать стационарные вероятности состояний и временные характеристики в рамках единого алгоритма; обслуживание аппроксимируется \(H_2\) при любом коэффициенте вариации, при необходимости с комплексными параметрами.

\section{Постановка задачи}
Рассматривается многоканальная система массового обслуживания с пуассоновскими потоками положительных (интенсивность \(\lambda\)) и отрицательных (интенсивность \(\delta\)) заявок, временем обслуживания \(B\), аппроксимируемым гиперэкспоненциальным распределением \(H_2\) с заданным средним и коэффициентом вариации, и числом каналов \(n\ge 1\). Коэффициент загрузки \(\rho=n^{-1}\lambda\,\mathbb{E}[B]\) предполагается меньше единицы.

Исследуются две дисциплины обработки отрицательных заявок:
\begin{enumerate}[leftmargin=1.5em]
  \item \textbf{RCS} (Remove Customer in Service) --- удаление одной заявки, находящейся в обслуживании;
  \item \textbf{катастрофы} --- мгновенная очистка системы от всех положительных заявок.
\end{enumerate}
Для каждой дисциплины рассматриваются два варианта поведения вытесненных положительных заявок: уход из системы и направление на повторное обслуживание (рестарт).

Пространство состояний усекается по уровню \(i\le N-1\) (\(N\) --- максимальный уровень); сходимость итераций контролируется по изменению \(x[i]\) или \(t[i]\) с заданным допуском.

%----------------------------------------------------------------------------------------
%  BASE TAKAHASHI-TAKAMI
%----------------------------------------------------------------------------------------
\section{Метод Такахаси--Таками: базовые принципы}
\subsection{Структура микросостояний}
Метод основан на представлении системы \(M/H_2/n\) в виде марковского процесса с дискретным пространством состояний. Состояние описывается:
\begin{itemize}[leftmargin=1.2em]
  \item \(i\) --- число заявок в системе (уровень, level);
  \item \(j\) --- число заявок, находящихся в фазе~2 \(H_2\)-аппроксимации (с интенсивностью \(\mu_2\); микросостояние, microstate).
\end{itemize}
Для уровня \(i<n\) число микросостояний равно \(i+1\), для \(i\ge n\) постоянно и равно \(n+1\).

\subsection{Матрицы переходов}
Процесс описывается четырьмя типами матриц переходов между микросостояниями соседних уровней: \(A\) (поступление), \(B\) (уход вниз), \(C\) (горизонтальные переходы), \(D\) (диагональная матрица интенсивностей выхода).

Пусть \(y_1+y_2=1\), где \(y_1\) и \(y_2\) --- вероятности выбора фаз 1 и 2 в \(H_2\)-аппроксимации, а \(\mu_1,\mu_2\) --- интенсивности экспоненциального обслуживания в фазах. На уровне \(i<n\) все заявки находятся в обслуживании, а на уровне \(i\ge n\) в обслуживании ровно \(n\) заявок, остальные ждут в очереди.

\subsubsection{Матрица \(A\) (поступление положительных заявок)}
Для \(i<n\) при приходе новая заявка немедленно занимает свободный канал и выбирает фазу:
\[
(i,j)\to(i+1,j)\ \text{с интенсивностью }\lambda y_1,\qquad
(i,j)\to(i+1,j+1)\ \text{с интенсивностью }\lambda y_2.
\]
Для \(i\ge n\) пришедшая заявка становится в очередь, и микросостояние \(j\) (число заявок в фазе 2 среди обслуживаемых) не меняется:
\[
(i,j)\to(i+1,j)\ \text{с интенсивностью }\lambda.
\]

\subsubsection{Матрица \(B\) (уход на уровень вниз)}
Для \(i\le n\) уход вниз обусловлен завершением обслуживания одной из \(i\) заявок:
\[
(i,j)\to(i-1,j)\ \text{с интенсивностью }(i-j)\mu_1,\qquad
(i,j)\to(i-1,j-1)\ \text{с интенсивностью }j\mu_2.
\]
Для \(i>n\) уход вниз сопровождается тем, что освободившийся канал немедленно занимает заявка из очереди, выбирая фазу 1/2 с вероятностями \(y_1/y_2\). Поэтому для \(j\in\{0,1,\dots,n\}\):
\begin{align*}
(i,j)\to(i-1,j)\ &\text{с интенсивностью }(n-j)\mu_1 y_1 + j\mu_2 y_2,\\
(i,j)\to(i-1,j+1)\ &\text{с интенсивностью }(n-j)\mu_1 y_2,\qquad (j<n),\\
(i,j)\to(i-1,j-1)\ &\text{с интенсивностью }j\mu_2 y_1,\qquad (j>0).
\end{align*}

\subsubsection{Матрица \(D\) (интенсивности выхода)}
Диагональные элементы задаются суммарной интенсивностью выхода из микросостояния. Для \(i<n\):
\[
D(i,j)=\lambda + (i-j)\mu_1 + j\mu_2,
\]
а для \(i\ge n\):
\[
D(i,j)=\lambda + (n-j)\mu_1 + j\mu_2.
\]

\textbf{Примеры для \(n=3\), уровень \(i=2\):} матрицы \(A_1\) (переход 1\(\to\)2), \(B_2\) (переход 2\(\to\)1) и \(D_2\) (диагональ выхода) можно компактно записать на одном уровне:
{\scriptsize
\[
\setlength{\arraycolsep}{2pt}%
\begin{array}{c@{\hspace{0.9em}}c@{\hspace{0.9em}}c}
A_1=\begin{pmatrix}
\lambda y_1 & \lambda y_2 & 0\\
0 & \lambda y_1 & \lambda y_2
\end{pmatrix}
&
B_2=\begin{pmatrix}
2\mu_1 & 0\\
\mu_2 & \mu_1\\
0 & 2\mu_2
\end{pmatrix}
&
D_2=\begin{pmatrix}
\lambda+2\mu_1 & 0 & 0\\
0 & \lambda+\mu_1+\mu_2 & 0\\
0 & 0 & \lambda+2\mu_2
\end{pmatrix}.
\end{array}
\]
}

\subsection{Итерационный алгоритм}
Алгоритм Такахаси--Таками основан на итерационном вычислении вспомогательных величин для уровней \(i=0,1,\dots,N-1\) и последующем восстановлении вероятностей уровней \(p[i]\). В типичной реализации используются:
\begin{itemize}[leftmargin=1.2em]
  \item вспомогательные матрицы \(G_i=(D_i-C_i)^{-1}\), а также произведения \(A_{i-1}G_i\) и \(B_{i+1}G_i\);
  \item итерации по уровням для обновления векторов \(t[i]\) и скаляров \(x[i],z[i]\) до сходимости;
  \item восстановление вероятностей уровней по рекуррентной формуле \(p[i]=p[i-1]x[i-1]\) при нормировке.
\end{itemize}

\textbf{Построение матриц:} для каждого уровня \(i\) по микросостоянию \(j\) заполняются блоки: (1) \(A\) --- переходы вверх по правилам для \(i<n\) и \(i\ge n\); (2) \(B\) --- переходы вниз из завершений обслуживания и выбора фазы при \(i>n\); (3) \(C\) --- горизонтальные переходы; (4) диагональ \(D\) так, чтобы сумма по строкам в \(A+B+C-D\) равнялась нулю. Размеры блоков определяются числом микросостояний на соседних уровнях.

\textbf{Выбор \(N\), сходимость, сложность:} \(N\) выбирают так, чтобы \(p[N-1]x[N-1]<\varepsilon\). Итерации прекращают при \(\max_i|x[i]^{\mathrm{new}}-x[i]^{\mathrm{old}}|<\varepsilon\). Время одного шага итерации --- \(O(N(n+1)^3)\), память --- \(O(N(n+1)^2)\).

\subsection{Временные характеристики в базовой модели}
Для базовой системы без отрицательных заявок моменты ожидания \(w^{(k)}\) могут вычисляться по вероятностям уровней:
\[
w^{(k)} = \frac{1}{\lambda^{k+1}} \sum_{j=k+1}^{N-n} j (j-1)\cdots(j-k)\, p[n+j],
\]
где \(k=0\) соответствует первому начальному моменту \(w_1=\mathbb{E}[W]\), \(k=1\) --- второму \(w_2=\mathbb{E}[W^2]\) и т.\,д. Моменты пребывания при отсутствии отрицательных заявок получаются стандартной свёрткой моментов ожидания и обслуживания. Для систем с отрицательными воздействиями моменты вычисляются либо по вероятностям уровней (в редуцированных аппроксимациях к \(M/G/n\)), либо восстанавливаются из ПЛС численным дифференцированием: \((-1)^k T^{* (k)}(0)\) аппроксимируется конечными разностями по \(s\) в окрестности нуля (шаг \(h\sim 10^{-5}\)--\(10^{-4}\)); устойчиво ограничены первые 2--4 момента.

%----------------------------------------------------------------------------------------
%  EXTENSIONS: NEGATIVE ARRIVALS
%----------------------------------------------------------------------------------------
\section{Расширение метода для систем с отрицательными заявками}
\subsection{Общая идея}
Расширение основано на модификации матриц переходов базового метода без изменения общей структуры итерационного процесса. В зависимости от дисциплины отрицательного воздействия переопределяются правила построения матриц \(B\) и \(D\), а для катастроф --- также структура микросостояний.

\subsection{Дисциплина RCS (Remove Customer in Service)}
При дисциплине RCS отрицательная заявка воздействует на одну заявку в обслуживании, выбирая занятый канал равновероятно. На уровнях \(i\le n\) (очереди нет) отрицательные события добавляют к уходам вниз интенсивности
\[
(i,j)\to(i-1,j)\ \text{с интенсивностью }\delta\frac{i-j}{i},\qquad
(i,j)\to(i-1,j-1)\ \text{с интенсивностью }\delta\frac{j}{i},
\]
то есть эквивалентны дополнительной «опасности удаления» \(\delta/i\) для каждой обслуживаемой заявки. Диагональные элементы дополняются интенсивностью отрицательных приходов:
\[
D_{\text{RCS}}(i,j)=D_{\text{base}}(i,j)+\delta.
\]

На уровнях \(i>n\) отрицательное событие также удаляет одну из \(n\) заявок в обслуживании, после чего канал немедленно занимает заявка из очереди и выбирает фазу. В рамках структуры Такахаси--Таками это приводит к добавлению интенсивностей, зависящих от микросостояния \(j\), в матрицу \(B_{n+1}\) (уровень, соответствующий полной занятости \(n\) каналов), а для всех уровней \(i\ge n+1\) используются те же матрицы, поскольку число микросостояний стабилизируется и равно \(n+1\).

\subsection{Дисциплина катастроф}
При базовой дисциплине обслуживания катастрофа очищает систему (удаляет все положительные заявки). Для согласования с матричной структурой метода вводится искусственное микросостояние \(D\) («состояние катастрофы») на каждом уровне \(i>0\). При поступлении отрицательной заявки система переходит в состояние \(D\), а затем с большой искусственной интенсивностью \(\gamma\gg\mu_1,\mu_2,\lambda\) --- в нулевой уровень, что моделирует мгновенную очистку.

Структура микросостояний модифицируется так:
\begin{itemize}[leftmargin=1.2em]
  \item уровень \(0\): одно состояние \((0,0)\);
  \item уровни \(1\le i<n+1\): \(1+(i+1)\) микросостояний (первое --- \(D\), затем \((i,0),\dots,(i,i)\));
  \item уровни \(i\ge n+1\): \(1+(n+1)\) микросостояний (первое --- \(D\), затем \((i,0),\dots,(i,n)\)).
\end{itemize}

Поступление положительных заявок (\(A\)) «пропускает» состояние \(D\). Для уровня \(0\):
\[
(0,0)\to(1,0)\ \text{с интенсивностью }\lambda y_1,\qquad
(0,0)\to(1,1)\ \text{с интенсивностью }\lambda y_2.
\]
Для уровня \(i>0\) положительный приход переводит \((i,j)\) в соответствующее обычное состояние уровня \(i+1\), сохраняя описанную выше структуру (без попадания в \(D\)).

Переход в катастрофическое состояние происходит из любого обычного микросостояния уровня \(i>0\) с интенсивностью \(\delta\). Состояние \(D\) имеет уход в \((0,0)\) с интенсивностью \(\gamma\), поэтому диагональный элемент для этого состояния (суммарная интенсивность выхода) равен \(\gamma\). Для уровня \(i=1\) при \(n=3\) микросостояния суть \(D\), \((1,0)\), \((1,1)\); матрица \(B_1\) имеет размер \(3\times 1\) (переход в уровень 0).

\subsection{Примеры матриц переходов}
Переходы по завершению обслуживания (интенсивности \(\mu_1,\mu_2\)) в базе M/H\(_2\)/\(n\) стандартны, поэтому ниже для каждой дисциплины приведены только переходы, возникающие из отрицательных воздействий (интенсивность \(\delta\) и производные; для катастроф также \(\gamma\)).

\subsubsection{RCS (удаление из системы)}
При построении матриц \(B_i\) к «стандартным» интенсивностям обслуживания добавляются интенсивности отрицательных воздействий. В качестве наглядного примера приведём матрицу \(B_2\) для дисциплины RCS при \(n\ge 2\) (уровень \(i=2\), микросостояния \(j=0,1,2\) на уровне 2 и \(j=0,1\) на уровне 1). Тогда
\[
B_2=
\begin{pmatrix}
2\mu_1+\delta & 0\\
\mu_2+\delta/2 & \mu_1+\delta/2\\
0 & 2\mu_2+\delta
\end{pmatrix},
\]
где, например, элемент \((2,1)\to(1,1)\) равен \(\mu_1+\delta/2\): он складывается из обслуживания фазы~1 и удаления заявки в фазе~1 отрицательным прибытием (равновероятный выбор канала среди двух занятых). Матрица \(C_i\) совпадает с базовой (горизонтальные переходы отсутствуют при удалении из системы).

\subsubsection{RCS (повторное обслуживание)}
При повторном обслуживании отрицательное воздействие не меняет числа заявок в системе, а лишь прерывает обслуживание одной случайной заявки и возвращает её в очередь с рестартом. Для этой постановки временные характеристики (раздел~4) и все численные результаты (раздел~5) рассчитываются по аппроксимации через эффективное время обслуживания \(B_{\mathrm{eff}}\). Матричное описание через горизонтальные переходы в \(C_i\) для данного случая в расчётах не используется и здесь не приводится.

\subsubsection{Катастрофы (очищение системы)}
Для катастроф с очищением вводится дополнительное микросостояние \(D\) на каждом уровне \(i>0\). Приведём примеры матриц \(B_1\) и \(C_1\) при \(n\ge 1\) (уровень \(i=1\), микросостояния: \(D\), \((1,0)\), \((1,1)\); переход в уровень 0) --- блок \(3\times 1\) и матрица горизонтальных переходов:
{\scriptsize
\[
\setlength{\arraycolsep}{2pt}%
\begin{array}{c@{\hspace{1.2em}}c}
B_1=\begin{pmatrix}
\gamma \\ \mu_1+\delta \\ \mu_2+\delta
\end{pmatrix}
&
C_1=\begin{pmatrix}
0 & 0 & 0\\
\delta & 0 & 0\\
\delta & 0 & 0
\end{pmatrix}.
\end{array}
\]
}
Первая строка соответствует состоянию \(D\): система переходит в \((0,0)\) с интенсивностью \(\gamma\gg\mu_1,\mu_2,\lambda\). Вторая и третья строки соответствуют обычным состояниям \((1,0)\) и \((1,1)\): уход в уровень 0 происходит либо по завершению обслуживания (\(\mu_1\), \(\mu_2\)), либо по поступлению катастрофы (интенсивность \(\delta\) добавляется к соответствующему переходу).

Матрица \(C_1\) моделирует горизонтальные переходы из обычных состояний в катастрофическое состояние \(D\),
где элементы \((1,0)\to D\) и \((1,1)\to D\) равны \(\delta\) (поступление катастрофы мгновенно переводит систему в состояние \(D\)). В программной реализации используется эквивалентный подход: переходы по катастрофе включены непосредственно в матрицу \(B\) (нисходящие переходы из обычных состояний в уровень ниже), при этом \(C\) остаётся нулевой; оба варианта дают одинаковые стационарные вероятности.

\subsubsection{Катастрофы (повторное обслуживание)}
При повторном обслуживании катастрофа не очищает систему, а прерывает все обслуживания и возвращает заявки в очередь с рестартом. Для этой постановки временные характеристики (раздел~4) и все численные результаты (раздел~5) рассчитываются по аппроксимации через эффективное время обслуживания \(B_{\mathrm{eff}}\). Матричное описание через горизонтальные переходы в \(C_i\) для данного случая в расчётах не используется и здесь не приводится.

\begin{figure}[h]
\centering
\begin{subfigure}[t]{0.49\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/rcs/diagrams/neg_arrivals_супер.png}
  \caption{RCS (удаление заявки из обслуживания)}
  \label{fig:rcs_transitions}
\end{subfigure}\hfill
\begin{subfigure}[t]{0.49\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/disaster/diagrams/disaster_negative_arrivals_pretty.png}
  \caption{Катастрофы (интенсивности \(\delta\) и \(\gamma\))}
  \label{fig:disaster_transitions}
\end{subfigure}
\caption{Переходы, вызванные отрицательными воздействиями, при \(n=3\) (уровни \(0,\dots,n\) для RCS и \(0,\dots,n+1\) для катастроф).}
\label{fig:negative_transitions}
\end{figure}

%----------------------------------------------------------------------------------------
%  SOJOURN / WAITING TIMES VIA PLS
%----------------------------------------------------------------------------------------
\section{Расчёт временных характеристик}
\subsection{Дисциплина RCS}
\subsubsection{RCS с удалением из системы}
Схема переходов, вызванных отрицательными воздействиями при дисциплине RCS (удаление заявки из обслуживания), приведена на рисунке~\ref{fig:rcs_transitions}.
Для типичной заявки, находящейся в обслуживании при \(m\) занятых каналах, интенсивность удаления аппроксимируется как \(r(m)=\delta/m\). При дисциплине «удаление из обслуживания» время в обслуживании:
\[
S=\min(B,Y),\qquad Y\sim\mathrm{Exp}(r),
\]
и ПЛС времени обслуживания \(S^*(s)=\frac{r}{s+r}+\frac{s}{s+r}\beta(s+r)\), где \(\beta(s)=\mathbb{E}[e^{-sB}]\). При этом ожидающие в очереди положительные заявки отрицательными воздействиями не удаляются, поэтому \(W\) трактуется как время до \emph{начала} обслуживания. Влияние \(\delta\) на \(W\) учитывается косвенно: удаление одной из обслуживаемых заявок освобождает прибор и тем самым может ускорять запуск ожидания.

\subsubsection{RCS с повторным обслуживанием}
Если отрицательное событие интерпретируется как прерывание обслуживания с возвратом заявки в очередь (рестарт обслуживания и повторная генерация длительности), расчёт сводится к \emph{эффективному времени обслуживания} \(B_{\mathrm{eff}}\) при пуассоновских рестартах. Пусть \(B\) имеет ПЛС \(\beta(s)\), рестарты --- с интенсивностью \(r\). Для модели «прерывание--повтор» время до завершения либо меньше первого рестарта (вклад в ПЛС даёт \(\beta(s+r)\) с учётом условного распределения времени до рестарта), либо после рестарта процесс обновляется; из обновляющего уравнения для ПЛС времени завершения получается:
\[
B_{\mathrm{eff}}^{*}(s)=\beta(s+r)\cdot\frac{s+r}{s+r\,\beta(s+r)}.
\]
Для RCS типичная заявка при \(m\) занятых каналах имеет интенсивность рестарта \(r(m)=\delta/m\); в расчёте \(r\) оценивается самосогласованно (итерационно), начиная с приближения \(r\approx\delta/n\). Система аппроксимируется стандартной \(M/G/n\) без отрицательных выходов с распределением \(B_{\mathrm{eff}}\); тогда \(V=W+B_{\mathrm{eff}}\), \(q=1\), \(V_{\text{served}}\equiv V\), \(V_{\text{broken}}\equiv 0\). Моменты \(W\) и \(V\) вычисляются базовым алгоритмом Такахаси--Таками для \(M/G/n\) с распределением \(B_{\mathrm{eff}}\).

\paragraph{Повтор без пересемплирования (фиксированная длительность).}
В ряде приложений естественна дисциплина, при которой длительность обслуживания \(B\) семплируется \emph{один раз} для заявки, но при каждом прерывании обслуживание начинается заново и уже выполненная работа теряется. Тогда классическая формула для \(B_{\mathrm{eff}}^{*}(s)\) (рестарт с перегенерацией) неприменима. Для фиксированного \(B=b\) и пуассоновских прерываний с интенсивностью \(r\) время завершения \(T\) имеет моменты
\[
\mathbb{E}[T\mid b]=\frac{e^{rb}-1}{r},\qquad
\mathbb{E}[T^2\mid b]=\frac{2e^{rb}}{r^2}\,\bigl(e^{rb}-1-rb\bigr).
\]
Безусловные моменты выражаются через значения производящей функции моментов \(M_B(t)=\mathbb{E}[e^{tB}]\) при \(t=r,2r\). В частности, \(\mathbb{E}[T]<\infty\) требует конечности \(M_B(r)\), а \(\mathbb{E}[T^2]<\infty\) --- конечности \(M_B(2r)\); поэтому при больших \(\delta\) (и/или больших \(CV\)) моменты могут резко возрастать или становиться бесконечными. В численных экспериментах (раздел~5) для этой дисциплины используется ограниченный диапазон \(\delta\).

\subsection{Дисциплина катастроф}
\subsubsection{Катастрофы с очищением}
Схема переходов, вызванных катастрофическими воздействиями (интенсивности \(\delta\) и \(\gamma\)), приведена на рисунке~\ref{fig:disaster_transitions}.
Пусть \(Y\sim\mathrm{Exp}(\delta)\) --- время до ближайшей катастрофы после прихода типичной заявки. Для получения результатов, согласованных с имитационным моделированием, вводятся гипотетические величины \(W_0\) и \(Z_0=W_0+B\), соответствующие динамике, в которой катастрофы \emph{после прихода данной заявки} отключены (но состояние при приходе берётся из стационара исходной системы). ПЛС \(W_0^*(s)\) вычисляется по стационарным вероятностям уровней \(p[k]\) модели с катастрофами и переходным вероятностям базовой системы \(M/H_2/n\) (без катастроф): при приходе в состояние с уровнем \(k<n\) заявка сразу поступает на обслуживание (\(W_0=0\)); при \(k\ge n\) вклад даёт сумма по уровням с весами, зависящими от времени до освобождения места в приборе. Тогда
\[
W=\min(W_0,Y),\qquad V=\min(Z_0,Y),
\]
и для любой независимой пары \(T\) и \(Y\sim\mathrm{Exp}(\delta)\) справедливо:
\[
\mathbb{E}[e^{-s\min(T,Y)}]=\frac{\delta}{s+\delta}+\frac{s}{s+\delta}T^*(s+\delta).
\]
Отсюда:
\[
W^*(s)=\frac{\delta}{s+\delta}+\frac{s}{s+\delta}W_0^*(s+\delta),\qquad
V^*(s)=\frac{\delta}{s+\delta}+\frac{s}{s+\delta}Z_0^*(s+\delta).
\]
Вероятность успешного обслуживания:
\[
p_{\text{served}}=\mathbb{P}(Z_0<Y)=\mathbb{E}[e^{-\delta Z_0}]=Z_0^*(\delta),
\]
а ПЛС условных распределений:
\[
\mathbb{E}[e^{-sV}\mid \text{served}]=\frac{Z_0^*(s+\delta)}{Z_0^*(\delta)},\qquad
\mathbb{E}[e^{-sV}\mid \text{broken}]=\frac{\delta}{s+\delta}\cdot\frac{1-Z_0^*(s+\delta)}{1-Z_0^*(\delta)}.
\]

\subsubsection{Катастрофы с повторным обслуживанием}
При дисциплине «катастрофа прерывает обслуживание всех заявок в каналах и возвращает их в очередь с рестартом» прерванных в смысле удалённых заявок нет: \(q=1\), \(V_{\text{served}}\equiv V\), \(V_{\text{broken}}\equiv 0\). Эффективное время обслуживания \(B_{\mathrm{eff}}\) при пуассоновских рестартах с интенсивностью \(\delta\) (каждая катастрофа прерывает любую заявку в канале) задаётся той же формулой, что и выше, с \(r=\delta\):
\[
B_{\mathrm{eff}}^{*}(s)=\beta(s+\delta)\cdot\frac{s+\delta}{s+\delta\,\beta(s+\delta)}.
\]
Система в приближении сводится к стандартной \(M/G/n\) без отрицательных выходов с распределением \(B_{\mathrm{eff}}\); \(V=W+B_{\mathrm{eff}}\), моменты получаются численным дифференцированием ПЛС (с гамма-аппроксимацией \(\beta(s)\) по первым двум моментам \(B\)).

\paragraph{Повтор без пересемплирования (фиксированная длительность).}
Аналогично RCS, можно рассмотреть дисциплину, когда при каждой катастрофе обслуживание всех заявок в каналах начинается заново, но исходные длительности обслуживания сохраняются (каждая заявка имеет фиксированный \(B\)). В этом случае приведённые выше формулы для моментов \(T\mid B=b\) применимы с \(r=\delta\); далее система аппроксимируется эквивалентной \(M/G/n\) с эффективными моментами \(B_{\mathrm{eff}}\), полученными из \(H_2\)-аппроксимации \(B\). Для корректного сравнения с ИМ ограничиваем \(\delta\) так, чтобы существовали первые 1--2 момента \(B_{\mathrm{eff}}\).

%----------------------------------------------------------------------------------------
%  NUMERICAL RESULTS
%----------------------------------------------------------------------------------------
\section{Численные результаты и сравнение с имитационным моделированием}
\subsection{Параметры тестов}
В качестве базового примера использовались параметры: \(n=3\), \(\lambda_{\text{pos}}=1{,}0\), \(\delta=0{,}3\), \(\rho=0{,}7\), коэффициент вариации времени обслуживания \(CV=1{,}2\), размер выборки в имитационном моделировании \(200\,000\).
Дополнительно, чтобы показать применимость метода при различных коэффициентах вариации времени обслуживания, в таблице~\ref{tab:results} приведены численные значения для \(CV=0{,}8\) и \(CV=1{,}2\).
Для дисциплины «повтор без пересемплирования» (фиксированная длительность обслуживания на заявку) диапазон \(\delta\) в графиках ограничивается: из-за возникновения дополнительной работы распределение времени завершения имеет тяжёлый хвост, а моменты зависят от существования \(M_B(r)\) и \(M_B(2r)\) (раздел~4). Поэтому для этой дисциплины в экспериментах используются меньшие значения \(\delta\) по сравнению с базовым примером.

\subsection{Сравнение численного метода и ИМ по \(w_1\) и \(v_1\)}
В таблице~\ref{tab:results} приведены первые начальные моменты времени ожидания (\(w_1\)) и пребывания (\(v_1\)) для четырёх вариантов обработки отрицательных заявок (удаление/очищение и повторное обслуживание) при двух значениях коэффициента вариации времени обслуживания; для каждого значения CV приведено сравнение с имитационным моделированием (ИМ).

\begin{table}[h]
\centering
\small
\begin{tabular}{@{}lcccccc@{}}
\toprule
 & \multicolumn{3}{c}{$w_1$} & \multicolumn{3}{c}{$v_1$} \\
\cmidrule(lr){2-4} \cmidrule(lr){5-7}
Дисциплина & Числ & ИМ & Отн.\% & Числ & ИМ & Отн.\% \\
\midrule
\multicolumn{7}{@{}l}{\textit{Коэффициент вариации} $CV=0{,}8$} \\
RCS (удаление) & 0.4205 & 0.4089 & 2.82 & 2.0952 & 2.0790 & 0.78 \\
RCS (повторное обслуж.) & 1.1906 & 1.1523 & 3.33 & 3.3685 & 3.3938 & $-$0.75 \\
Катастрофы (очищение) & 0.1964 & 0.1922 & 2.17 & 1.4853 & 1.4814 & 0.27 \\
Катастрофы (повторное обслуж.) & 1.8268 & 1.8552 & $-$1.53 & 4.1527 & 4.2008 & $-$1.15 \\
\midrule
\multicolumn{7}{@{}l}{\textit{Коэффициент вариации} $CV=1{,}2$ (базовое значение)} \\
RCS (удаление) & 0.3881 & 0.4002 & $-$3.03 & 1.9127 & 1.9230 & $-$0.54 \\
RCS (повторное обслуж.) & 1.0842 & 1.0451 & 3.74 & 3.0981 & 3.0900 & 0.26 \\
Катастрофы (очищение) & 0.1613 & 0.1693 & $-$4.73 & 1.3096 & 1.3174 & $-$0.59 \\
Катастрофы (повторное обслуж.) & 0.7583 & 0.7869 & $-$3.64 & 2.6441 & 2.6800 & $-$1.34 \\
\bottomrule
\end{tabular}
\caption{Первые начальные моменты времени ожидания \(w_1\) и пребывания \(v_1\) при фиксированных \(n=3\), \(\lambda_{\text{pos}}=1{,}0\), \(\delta=0{,}3\), \(\rho=0{,}7\) и различных коэффициентах вариации времени обслуживания. Числ --- численный расчёт, ИМ --- имитационное моделирование, Отн.\% --- относительная погрешность.}
\label{tab:results}
\end{table}

В таблице~\ref{tab:sko} приведены среднеквадратичные отклонения \(\sigma_W\) и \(\sigma_V\) для тех же дисциплин обслуживания отрицательных заявок и значений коэффициента вариации.

\begin{table}[h]
\centering
\small
\begin{tabular}{@{}lcccccc@{}}
\toprule
 & \multicolumn{3}{c}{$\sigma_W$} & \multicolumn{3}{c}{$\sigma_V$} \\
\cmidrule(lr){2-4} \cmidrule(lr){5-7}
Дисциплина & Числ & ИМ & Отн.\% & Числ & ИМ & Отн.\% \\
\midrule
\multicolumn{7}{@{}l}{\textit{Коэффициент вариации} $CV=0{,}8$} \\
RCS (удаление) & 0.9291 & 0.9106 & 2.03 & 1.7136 & 1.6963 & 1.02 \\
RCS (повторное обслуж.) & 1.9534 & 1.9765 & $-$1.17 & 2.6513 & 2.6955 & $-$1.64 \\
Катастрофы (очищение) & 0.5615 & 0.5503 & 2.04 & 1.2682 & 1.2611 & 0.57 \\
Катастрофы (повторное обслуж.) & 2.7441 & 2.8083 & $-$2.29 & 3.3921 & 3.4596 & $-$1.95 \\
\midrule
\multicolumn{7}{@{}l}{\textit{Коэффициент вариации} $CV=1{,}2$ (базовое значение)} \\
RCS (удаление) & 1.0082 & 1.0398 & $-$3.04 & 2.0878 & 2.0935 & $-$0.27 \\
RCS (повторное обслуж.) & 2.0361 & 2.0469 & $-$0.53 & 3.1204 & 3.1239 & $-$0.11 \\
Катастрофы (очищение) & 0.5599 & 0.5833 & $-$4.01 & 1.4312 & 1.4404 & $-$0.64 \\
Катастрофы (повторное обслуж.) & 1.5502 & 1.5761 & $-$1.65 & 2.6529 & 2.6554 & $-$0.10 \\
\bottomrule
\end{tabular}
\caption{Среднеквадратичные отклонения $\sigma_W$ и $\sigma_V$ при фиксированных $n=3$, $\lambda_{\text{pos}}=1{,}0$, $\delta=0{,}3$, $\rho=0{,}7$ и различных коэффициентах вариации времени обслуживания.}
\label{tab:sko}
\end{table}

Для дисциплины «повтор без пересемплирования» (фиксированная длительность обслуживания на заявку) базовое значение \(\delta=0{,}3\) использовать нельзя: моменты времени завершения быстро растут и могут не существовать (см. раздел~4). Поэтому отдельное сравнение численного метода и ИМ для этой дисциплины приведено в таблице~\ref{tab:results_fixed} при меньшей интенсивности \(\delta\).

% Auto-generated by works/negative_queues/export_fixed_service_tables.py
\input{generated_tables_fixed.tex}

Заметны несколько устойчивых закономерностей. Во-первых, дисциплины с \emph{удалением} (RCS) и \emph{очищением} (катастрофы) дают наименьшие значения \(w_1\) и \(v_1\): отрицательные воздействия в этих постановках уменьшают «эффективную загрузку» системы за счёт преждевременного завершения обслуживания и/или мгновенного сброса заявок. Во-вторых, при \emph{повторном обслуживании} (рестартах) значения \(w_1\) и \(v_1\) в среднем выше, особенно при малом \(CV\), так как рестарт приводит к потере уже выполненной части обслуживания.

Согласование численного метода с имитационным моделированием в таблицах~\ref{tab:results}--\ref{tab:sko} в целом хорошее. В таблице~\ref{tab:results} относительная погрешность для \(v_1\), как правило, не превышает \(1\text{--}2\%\), а для \(w_1\) --- нескольких процентов (в приведённых тестах максимум порядка \(5\%\)). Для среднеквадратичных отклонений (таблица~\ref{tab:sko}) погрешности также остаются на уровне нескольких процентов (обычно \(<4\%\)). Наибольшая чувствительность наблюдается для \(w_1\) и \(\sigma_W\) при больших \(CV\), что связано с влиянием хвостов распределений и приближениями, используемыми в расчёте (в частности, аппроксимацией интенсивностей рестартов/удалений и моментной аппроксимацией распределений).

Для дисциплины «повтор без пересемплирования» (таблица~\ref{tab:results_fixed}) расхождения с ИМ заметно выше, особенно для катастроф: относительные ошибки по \(w_1\) и \(v_1\) могут достигать порядка \(5\text{--}10\%\). Это согласуется с тем, что при фиксированной длительности обслуживания и прерываниях средние и дисперсии становятся чувствительны к хвостам распределений и конечности производящей функции моментов \(M_B(r)\) (см. раздел~4), а также к конечной длине имитационной выборки.

\subsection{Графики параметрических зависимостей}
% Пути channels_cv_compare и negative_rate_cv_compare соответствуют сводным рисункам (несколько CV на одном графике).
% Скрипт work_mgn_negatives.py формирует их автоматически, одновременно сохраняя результаты по каждому CV в каталоги channels_cv0_8, channels_cv1_2 и т.\,д.
На рисунке~\ref{fig:v1_n} приведены зависимости первого начального момента времени пребывания \(v_1\) от числа каналов \(n\) для четырёх дисциплин обслуживания отрицательных заявок при фиксированной интенсивности отрицательных воздействий \(\delta\). В качестве примера использовано базовое значение \(\delta=0{,}3\). Для зависимости по \(n\) графики при \(CV=0{,}8\) и \(CV=1{,}2\) имеют близкий характер и отличаются сравнительно слабо; поэтому далее приводим результаты только для базового значения \(CV=1{,}2\).

На рисунке~\ref{fig:v1_n_fixed} приведена аналогичная зависимость \(v_1(n)\) для дисциплины «повтор без пересемплирования» (fixed-service restarts). По тем же причинам (слабые отличия формы по \(n\) при разных \(CV\)) для наглядности показываем только \(CV=1{,}2\); при этом \(\delta\) в этом прогоне фиксировано малым (\(\delta=0{,}02\)) для сохранения устойчивого режима и приемлемой дисперсии оценок ИМ.

Видно, что увеличение числа каналов приводит к росту \(v_1\) при фиксированной \(\rho\), что соответствует линейному росту \(\mathbb{E}[B]=n\rho/\lambda_{\mathrm{pos}}\). Влияние коэффициента вариации времени обслуживания по точкам сравнения показано в таблице~\ref{tab:results}.

\begin{figure}[!htbp]
\centering
\begin{minipage}[t]{0.49\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/paper_fig2_delta_0_300/combined/v1_n_cv1_2_oldstyle.png}
  \captionof{figure}{Зависимость \(v_1\) от числа каналов \(n\) при \(\lambda_{\text{pos}}=1{,}0\), \(\delta=0{,}3\), \(\rho=0{,}7\), \(CV=1{,}2\). Пунктир --- ИМ, сплошная --- численный расчёт.}
  \label{fig:v1_n}
\end{minipage}\hfill
\begin{minipage}[t]{0.49\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/combined/v1_n_fixed_cv1_2.png}
  \captionof{figure}{Зависимость \(v_1\) от числа каналов \(n\) для дисциплины «повтор без пересемплирования» при \(\lambda_{\text{pos}}=1{,}0\), \(\delta=0{,}02\), \(\rho=0{,}7\), \(CV=1{,}2\).}
  \label{fig:v1_n_fixed}
\end{minipage}
\end{figure}

Отдельно отметим нетривиальный эффект для дисциплин с \emph{повторным обслуживанием} (рестартом). Для постановки \emph{вытесняющего повтора с перегенерацией} при прерывании заявка возвращается в очередь, а длительность обслуживания при следующем запуске генерируется заново. Для распределений с \(CV>1\) (существенная вариативность) более частые рестарты «отсекают» редкие очень длительные реализации обслуживания и повышают вероятность завершения по «быстрым» траекториям, в результате чего уменьшается \emph{эффективное} время обслуживания \(B_{\mathrm{eff}}\) и, как следствие, может снижаться \(v_1\) при увеличении \(\delta\). Для \(CV<1\) такой выигрыш отсутствует, и наблюдается ожидаемая зависимость: при увеличении частоты прерываний средние времена растут (рисунок~\ref{fig:v1_delta_cv_compare}).

\begin{figure}[!t]
\centering
\vspace{-0.6em}
\captionsetup{skip=3pt}
\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/rcs/remove/negative_rate_cv_compare/v_ave.png}
  \caption{RCS (удаление)}
\end{subfigure}\hfill
\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/rcs/requeue/negative_rate_cv_compare/v_ave.png}
  \caption{RCS (повторное обслуж.)}
\end{subfigure}

\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/disaster/clear/negative_rate_cv_compare/v_ave.png}
  \caption{Катастрофы (очищение)}
\end{subfigure}\hfill
\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/disaster/requeue/negative_rate_cv_compare/v_ave.png}
  \caption{Катастрофы (повторное обслуж.)}
\end{subfigure}
\caption{Зависимость \(v_1\) от интенсивности отрицательных воздействий \(\delta\) при \(n=3\), \(\lambda_{\text{pos}}=1{,}0\), \(\rho=0{,}7\), \(CV\in\{0{,}8;\;1{,}2\}\). Пунктир --- ИМ, сплошная --- численный расчёт.}
\label{fig:v1_delta_cv_compare}
\end{figure}

Рисунок~\ref{fig:v1_delta_cv_compare_fixed} иллюстрирует более «жёсткий» режим рестартов --- \emph{повтор без пересемплирования} (фиксированная длительность обслуживания на заявку с потерей уже выполненной работы при каждом прерывании). В отличие от случая с пересемплированием, увеличение \(\delta\) здесь приводит к резкому росту \(v_1\), причём эффект существенно усиливается при большем \(CV\): для \(CV=1{,}2\) хвост распределения времени завершения тяжелее, и рост среднего пребывания при увеличении частоты прерываний выражен сильнее. Поэтому диапазон \(\delta\) на рисунке ограничен условиями существования моментов (см. раздел~4); вблизи верхней границы диапазона расхождения между ИМ и численным расчётом закономерно возрастают из-за высокой дисперсии оценок и чувствительности к редким длительным траекториям.

\begin{figure}[!t]
\centering
\vspace{-0.6em}
\captionsetup{skip=3pt}
\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/rcs/requeue_fixed/negative_rate_cv_compare/v_ave.png}
  \caption{RCS (повтор без пересемпл.)}
\end{subfigure}\hfill
\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/disaster/requeue_fixed/negative_rate_cv_compare/v_ave.png}
  \caption{Катастрофы (повтор без пересемпл.)}
\end{subfigure}
\caption{Зависимость \(v_1\) от \(\delta\) для дисциплины «повтор без пересемплирования» при \(n=3\), \(\lambda_{\text{pos}}=1{,}0\), \(\rho=0{,}7\), \(CV\in\{0{,}8;\;1{,}2\}\). Диапазон \(\delta\) ограничен из-за быстрого роста моментов и условий их существования (см. раздел~4).}
\label{fig:v1_delta_cv_compare_fixed}
\end{figure}

Вероятность быть обслуженным \(q\) интерпретируется как доля положительных заявок, завершивших обслуживание. Для дисциплин с \emph{удалением} (RCS) и \emph{очищением} (катастрофы) \(q\) убывает с ростом \(\delta\), что отражает увеличение частоты «потерь» положительных заявок из системы. Для RCS (удаление) величина \(q\) в стационаре может быть также найдена из баланса потоков:
\[
q \;=\; 1 - \frac{\delta}{\lambda}\bigl(1-p_0\bigr),
\]
где \(p_0=\mathbb{P}\{i=0\}\) --- вероятность пустой системы (отрицательное событие «теряется» при \(i=0\)). Для дисциплин с \emph{повторным обслуживанием} графики \(q(\delta)\) не приводим: в рассматриваемой постановке положительные заявки не уничтожаются, а лишь прерываются и возвращаются в очередь, поэтому \(q\equiv 1\) и зависимость от \(\delta\) тривиальна. На рисунке~\ref{fig:q_delta_cv_compare} показана зависимость \(q(\delta)\) для дисциплин с удалением/очищением при \(n=3\), \(\lambda_{\text{pos}}=1{,}0\), \(\rho=0{,}7\), \(CV\in\{0{,}8;\;1{,}2\}\).

\begin{figure}[!htbp]
\centering
\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/rcs/remove/negative_rate_cv_compare/q.png}
  \caption{RCS (удаление)}
\end{subfigure}\hfill
\begin{subfigure}[t]{0.48\linewidth}
  \centering
  \maybeincludegraphics[width=\linewidth]{negative_queues_figures/disaster/clear/negative_rate_cv_compare/q.png}
  \caption{Катастрофы (очищение)}
\end{subfigure}
\caption{Зависимость вероятности быть обслуженным \(q\) от \(\delta\). Пунктир --- ИМ, сплошная --- численный расчёт.}
\label{fig:q_delta_cv_compare}
\end{figure}
\FloatBarrier

%----------------------------------------------------------------------------------------
%  CONCLUSION
%----------------------------------------------------------------------------------------
\section{Заключение}
В данной работе предложено расширение метода Такахаси--Таками для расчёта многоканальных систем массового обслуживания с отрицательными заявками. Основные результаты состоят в следующем.
\begin{enumerate}[leftmargin=1.5em]
  \item Разработаны правила модификации матриц переходов микросостояний для двух дисциплин обработки отрицательных заявок --- RCS (удаление заявки из обслуживания) и катастроф (мгновенная очистка системы) --- при двух вариантах поведения вытесненных заявок: уходе из системы и направлении на повторное обслуживание.
  \item Предложены алгоритмы вычисления временных характеристик (первых начальных моментов времени ожидания и пребывания) через преобразование Лапласа--Стилтьеса и численное дифференцирование. Для дисциплины катастроф корректный расчёт времени пребывания основан на операции минимума с экспоненциальным временем до ближайшей катастрофы.
  \item Проведено сравнение результатов численного метода с имитационным моделированием: относительная погрешность по первым моментам времени ожидания и пребывания не превышает нескольких процентов, аналогичный порядок точности наблюдается и для среднеквадратичных отклонений.
\end{enumerate}

Вычислительное время предложенного метода существенно меньше по сравнению с прямым имитационным моделированием: для базового примера (\(n=3\), \(\lambda_{\mathrm{pos}}=1{,}0\), \(\delta=0{,}3\), \(\rho=0{,}7\), \(CV=1{,}2\)) численный расчёт занимает порядка \(0{,}1\)\,с, тогда как имитационное моделирование на \(10^6\) заявок --- порядка \(10\)--\(15\)\,с, что делает метод пригодным для параметрического анализа и оптимизации.

В качестве направлений дальнейших исследований можно отметить обобщение предложенного подхода на системы с неоднородными каналами обслуживания, зависящими от состояния интенсивностями отрицательных воздействий, а также на многоклассовые модели с различными приоритетами. Программная реализация метода доступна в~\cite{mostqueue2026}.

\printbibliography

\end{document}

